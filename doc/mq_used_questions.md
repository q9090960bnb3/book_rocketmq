# rocketmq 常见问题

## 如何解决消息堆积问题

1.生产太快了
生产方可以做业务限流
增加消费者数量，但是消费者数量<=队列数量，适当的设置最大的消费线程数量(根据I0(2n)/CPU(n+1))
动态扩容队列数量，从而增加消费者数量
2.消费者消费出现问题
排查消费者程序的问题

## 如何确保消息不丢失?
1.生产者使用同步发送模式，收到9的返回确认以后顺便往自己的数据库里而写gId status(e) time
2.消费者消费以后修改数据这条消息的状态·1
3.写一个定时任务间限两天去查淘数据如果有status=eand time<day-2
4.将g的刷盘机制设置为同步刷盘
5.使用集群模式，搞主备模式，将消息持久化在不同的硬件上
6.可以开启g的trace机制，消息跟踪机制
- 1.在broker.conf中开启消息追踪
traceTopicEnable=true
- 2.重启broker即可
- 3.生产者配置文件开启消息轨迹
onable-nsg-trace: true
- 4.消费者开启消息轨迹功能，可以给单独的某一个消费者开启
enableMsgTrace =true